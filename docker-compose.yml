version: '3.8'

services:
  # Dashboard node (runs coordinator)
  dashboard:
    build: .
    ports:
      - "8000:8000"
    environment:
      - NODE_TYPE=coordinator
      - NUM_NODES=5
    networks:
      - sovereignmap
    command: python sovereignmap_poc.py

  # Worker nodes
  node-1:
    build: .
    environment:
      - NODE_ID=1
      - NODE_TYPE=worker
    networks:
      - sovereignmap
    depends_on:
      - dashboard

  node-2:
    build: .
    environment:
      - NODE_ID=2
      - NODE_TYPE=worker
    networks:
      - sovereignmap
    depends_on:
      - dashboard

  node-3:
    build: .
    environment:
      - NODE_ID=3
      - NODE_TYPE=worker
    networks:
      - sovereignmap
    depends_on:
      - dashboard

  node-4:
    build: .
    environment:
      - NODE_ID=4
      - NODE_TYPE=worker
    networks:
      - sovereignmap
    depends_on:
      - dashboard

  node-5:
    build: .
    environment:
      - NODE_ID=5
      - NODE_TYPE=worker
    networks:
      - sovereignmap
    depends_on:
      - dashboard

networks:
  sovereignmap:
    driver: bridge

# Usage:
# docker-compose up --build
# Dashboard: http://localhost:8000
# Scale nodes: docker-compose up --scale node-1=3
