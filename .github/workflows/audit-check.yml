name: SGP-001 Audit Sync

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  audit-validation:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Comprehensive Audit Validation
        run: |
          # Define required standards
          declare -A standards=(
            ["MIN_PARTICIPANTS"]="200"
            ["PRIVACY_BUDGET_EPSILON"]="0.98"
          )

          # Target the specific 200-node configuration file
          FILE="docker-compose.200nodes.yml"
          
          if [ ! -f "$FILE" ]; then
            echo "‚ùå Error: $FILE not found!"
            exit 1
          fi

          for var in "${!standards[@]}"; do
            # Extract value from the docker-compose file
            ACTUAL=$(grep "$var" "$FILE" | head -1 | cut -d'=' -f2 | tr -d ' "' | tr -d '\r' | xargs)
            EXPECTED=${standards[$var]}
            
            if [ -z "$ACTUAL" ] || [ "$ACTUAL" != "$EXPECTED" ]; then
              echo "‚ùå SGP-001 Violation: $var is '$ACTUAL' (Expected '$EXPECTED')"
              exit 1
            fi
            echo "‚úÖ $var verified: $ACTUAL"
          done
          echo "üöÄ All SGP-001 standards satisfied for 200-node cluster."
