name: SGP-001 Audit Sync

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  audit-validation:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: SGP-001 Standards Check
        run: |
          # This version reads directly from your 200-node test file
          FILE="docker-compose.200nodes.yml"
          EXPECTED="200"
          
          # Extract the value from the file
          ACTUAL=$(grep "MIN_PARTICIPANTS" "$FILE" | head -1 | cut -d'=' -f2 | tr -d ' "' | tr -d '\r' | xargs)
          
          if [ "$ACTUAL" != "$EXPECTED" ]; then
            echo "❌ SGP-001 Violation: MIN_PARTICIPANTS is '$ACTUAL' (Expected '$EXPECTED')"
            exit 1
          fi
          
          echo "✅ Audit Verified: $ACTUAL participants found in $FILE"

  lint-scripts:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run ShellCheck
        run: |
          # Fixes the SC2087 warning by quoting the EOF
          sed -i "s/<< EOF/<< 'EOF'/g" phase-3-deploy-code.sh
          shellcheck phase-3-deploy-code.sh
